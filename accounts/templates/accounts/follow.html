{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{ % bootstrap_css % }
{% block content %}
{% include 'nav.html' %}
<style>
  .font_style {
    text-decoration: none;
    color: black;
    text-align: center;
  }
</style>
<div class="row mt-5">
  <!-- 프로필 사이드 배너 -->
  {% if user == request.user %}
  <div class="col-2 px-5 pt-3">
    <ul class="list-group mb-1">
      <li class="pt-2 list-group-item list-group-item-action text-center bg-success text-light">계정</li>
      <li class="pt-2 list-group-item list-group-item-action text-center">
        <a href="{% url 'accounts:detail' user.pk %}" class="font_style">내 계정</a>
      </li>
      <li class="pt-2 list-group-item list-group-item-action text-center">
        <a href="{% url 'accounts:follow_list' user.pk %}" class="font_style">팔로우 관리</a>
      </li>
      <li class="pt-2 list-group-item list-group-item-action text-center">
        <a href="{% url 'accounts:profile_update' %}" class="font_style">프로필 설정</a>
      </li>
      <li class="pt-2 list-group-item list-group-item-action text-center">
        <a href="{% url 'accounts:password_update' %}" class="font_style">비밀번호 설정</a>
      </li>
      <li class="pt-2 list-group-item list-group-item-action text-center">
        <a class="font_style text-danger" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
          계정 삭제
        </a>
      </li>
    </ul>
    <ul class="list-group">
      <li class="pt-2 list-group-item list-group-item-action text-center bg-success text-light">
        쇼핑 내역
      </li>
      <li class="pt-2 list-group-item list-group-item-action text-center">
        <a href="{% url 'articles:shop' %}" class="font_style">장바구니</a>
      </li>
    </ul>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">계정 삭제</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          계정의 모든 정보가 영구적으로 삭제됩니다.
          <br>삭제하시겠습니까?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <form action="{% url 'accounts:delete' %}" method="POST">
            {% csrf_token %}
            <input type="submit" class="btn btn-danger" value="삭제">
          </form>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  <div class="col-4 p-2" style="width: 38rem;">
    {% if followers %}
    <h3>내가 팔로우한 사람들</h3>
    <div class="d-flex row">
      {% for follower in followers_list %}
      <div class="col-4">
        <a href="{% url 'accounts:detail' follower.pk %}" class="text-decoration-none text-dark">
          <div class="d-flex border rounded m-1 p-2">
            {% if follower.profile_image %}
            <img src="{{ follower.profile_image.url }}" alt="" class="small-image rounded-circle">
            {% else %}
            <img class="small-image rounded-circle" src="{% static '/images/profile_images/no-avatar.png' %}" alt="">
            {% endif %}
            <div class="ms-2">
              <p class="m-0">{{ follower.nickname }}</p>
              <p style="font-size:0.8rem;" class="m-0">{{ follower }}</p>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <h3>내가 팔로우한 사람들</h3>
    <div>내가 팔로우한 사람들이 없습니다.</div>
    {% endif %}
  </div>
  <div class="col-4 p-2" style="width: 38rem;">
    {% if followings %}
    <h3>나를 팔로우한 유저들</h3>
    <div class="d-flex row">
      {% for following in followings_list %}
      <div class="col-4">
        <a href="{% url 'accounts:detail' following.pk %}" class="text-decoration-none text-dark">
          <div class="d-flex border rounded m-1 p-2">
            {% if following.profile_image %}
            <img src="{{ following.profile_image.url }}" alt="" class="rounded-circle">
            {% else %}
            <img class="rounded-circle" src="{% static '/images/profile_default.png' %}" alt="">
            {% endif %}
            <div class="ms-2">
              <p class="m-0">{{ following.nickname }}</p>
              <p style="font-size:0.8rem;" class="m-0">{{ following }}</p>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <h3>나를 팔로우한 유저들</h3>
    <div>나를 팔로우한 유저들이 없습니다.</div>
    {% endif %}
  </div>
  {% endblock content %}
  {% block script %}
  <script>
    const followers = `{{followers}}`
    const followers_0 = `{{followers.0}}`
    // for (const i in followers) {
    //   console.log(i)
    // }
    console.log(followers)
    // console.log(followers_0)

    const btn_next = document.querySelector("#btn-next")
    btn_next.addEventListener('click', function (event) {
      const userId = event
        .target
        .dataset
        .userId
      axios({ method: 'get', url: `/accounts/${userId}/follow_list/js` })
        .then((response) => {
          console.log('성공')
        })
        .catch((error) => {
          if (error.response) {
            // 요청이 이루어졌으며 서버가 2xx의 범위를 벗어나는 상태 코드로 응답했습니다.
            console.log(error.response.data);
            console.log(error.response.status);
            console.log(error.response.headers);
          } else if (error.request) {
            // 요청이 이루어 졌으나 응답을 받지 못했습니다.
            // `error.request`는 브라우저의 XMLHttpRequest 인스턴스 또는
            // Node.js의 http.ClientRequest 인스턴스입니다.
            console.log(error.request);
          } else {
            // 오류를 발생시킨 요청을 설정하는 중에 문제가 발생했습니다.
            console.log('Error', error.message);
          }
          console.log(error.config);
        })
    })
  </script>
  {% endblock script %}